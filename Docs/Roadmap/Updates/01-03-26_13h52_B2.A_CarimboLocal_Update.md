# Carimbo Local â€” B2.A + Checklist 0-5

## Contexto
Execucao do roteiro objetivo (0-5) para validar runtime hardening + estabilidade local.

## 0) Preparar ambiente
- `git status` executado.
- Branch atual: `b1/remove-runtime-fallback-structural`.
- Working tree: suja (alteracoes preexistentes no workspace).
- Nenhum `UnrealEditor`/`UnrealEditor-Cmd` aberto no inicio.

## 1) Clean rebuild carimbo
Comando:
`powershell -ExecutionPolicy Bypass -File .\Scripts\omni_build_dev.ps1`

Resultado:
- `Result: Succeeded`
- Target up to date.

## 2) Forge determinism gate (CI local)
### 2.1 Conformance gate
Comando:
`pwsh -ExecutionPolicy Bypass -File .\Scripts\omni_conformance_gate.ps1`

Resultado:
- `Conformance gate PASSED. No B1/B0 conformance violations found.`

### 2.2 Artefatos
Checagem:
- `Saved/Omni/ResolvedManifest.json` -> `True`
- `Saved/Omni/ForgeReport.md` -> `True`
- `Saved/Omni/Generated/OmniGenerated.json` -> `True`

### 2.3 Determinismo headless
Comando:
`pwsh -ExecutionPolicy Bypass -File .\Scripts\compare_omni_forge_headless.ps1 -Artifact "Saved/Omni/Generated/OmniGenerated.json"`

Resultado:
- `Hash #1: FC68D3F01C27A43CBADAD57DAC0D8F71B17CD6C968DCF1F4EF6EDEE617B8D3C5`
- `Hash #2: FC68D3F01C27A43CBADAD57DAC0D8F71B17CD6C968DCF1F4EF6EDEE617B8D3C5`
- `SUCCESS: Hashes match.`

## 3) Auditoria grep
### 3.1 Fallback / DEV fallback
Comando:
`git grep -n "DevFallback|FallbackSystemClasses|bUseConfiguredFallbackSystems|BuildDevFallbackSettings|devfallback|omni\.devdefaults"`

Resumo:
- Runtime com fallback explicitamente guardado por flag e default OFF.
- `BuildDevFallbackSettings` nao aparece mais no runtime (apenas referencia de regra no script de conformance).

### 3.2 WorldTime
Comando:
`git grep -n "GetTimeSeconds\(\)|TimeSeconds|WorldTime|GetWorld\(\)->GetTimeSeconds"`

Resumo:
- Nao ha dependencia de `GetWorld()->GetTimeSeconds` no fluxo normal de Movement/Status/ActionGate.
- Ocorrencias restantes relevantes em:
  - debug (`OmniDebugSubsystem`/`OmniDebugTypes`),
  - nomes de variavel (`NextStartAttemptWorldTime`),
  - documentacao legada.

## 4) Tag hardening (teste negativo)
### 4.1 Injetar tag ilegal temporaria
- Inserida temporariamente em `Config/DefaultGameplayTags.ini`:
  - `Omni.Test.Illegal`

### 4.2 Subir runtime/headless
Comando:
`UnrealEditor-Cmd.exe ... -ExecCmds="quit"`

Resultado:
- Exit code `3` (falha esperada).
- Log confirmou fail-fast:
  - `[Omni][TagGuard] Falha de inicializacao: GameplayTag(s) Omni.* nao oficial(is): Omni.Test.Illegal...`

### 4.3 Cleanup
- Tag ilegal removida do arquivo de tags.

## 5) Smoke final
Comando:
`UnrealEditor-Cmd.exe ... -ExecCmds="omni.sprint start,omni.sprint status,omni.sprint stop,omni.sprint status,quit"`

Resultado:
- Execucao OK, sem crash.
- Evidencias de log:
  - `[Omni][TagGuard] Validacao de GameplayTags concluida: Omni.* encontrados=0, violacoes=0.`
  - `LogOmniRegistry: SystemRegistry initialized. Systems: 3...`
  - `LogOmniMovementSystem: Movement system initialized...`
  - `[Omni] Sprint solicitada...`
  - `[Omni] Sprint cancelada...`
  - `Closing by request`

## Conclusao
- Checklist local 0-5: **PASS**.
- Runtime com hardening ativo e smoke funcional.
